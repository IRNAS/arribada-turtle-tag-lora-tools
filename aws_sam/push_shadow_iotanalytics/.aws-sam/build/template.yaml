AWSTemplateFormatVersion: '2010-09-09'
Resources:
  ArribadaPushShadowIoTAnalyticsFunction:
    Events:
      IoTLoggingMessage:
        Properties:
          Sql: SELECT * AS update, topic(3) as thing_name FROM '$aws/things/+/shadow/update/documents'
        Type: IOTRule
    Properties:
      CodeUri: ArribadaPushShadowIoTAnalyticsFunction
      Handler: app.lambda_handler
      Policies:
      - AWSLambdaExecute
      - Statement:
        - Action:
          - logs:CreateLogGroup
          Effect: Allow
          Resource: arn:aws:logs:us-west-2:302222748002:*
        - Action:
          - logs:CreateLogStream
          - logs:PutLogEvents
          Effect: Allow
          Resource: arn:aws:logs:us-west-2:302222748002:log-group:/aws/lambda/ArribadaPushShadowIoTAnalyticsFunction:*
        - Action:
          - iotanalytics:BatchPutMessage
          Effect: Allow
          Resource: arn:aws:dynamodb:us-west-2:302222748002:channel/*
        Version: '2012-10-17'
      Runtime: python2.7
      Timeout: 10
    Type: AWS::Serverless::Function
Transform: AWS::Serverless-2016-10-31
